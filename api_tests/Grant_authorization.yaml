# Test generated by RoostGPT for test credential-integration-artillery using AI Type Open AI and AI Model gpt-4-1106-preview


config:
  target: "{{ $processEnvironment.API_HOST }}"
  phases:
    - duration: 60
      arrivalRate: 1
  payload:
    path: "Grant_authorization.csv"
    fields:
      - "authorizationToken"
      - "accountId"
    skipHeader: true
  plugins:
    expect: {}

scenarios:
  - name: "scenario Grant authorization"
    flow:
      # Create new Account
      - post:
          url: "/accounts"
          json:
            username: "{{ username }}"
            password: "{{ password }}"
          headers:
            Content-Type: "application/json"
          log: "Creating a new account."
          think: 1
          capture:
            json: "$.accountId"
            as: "createdAccountId"
          expect:
            - statusCode: 201
            - hasProperty: "accountId"

      # Authorize another existing Account to access my Account
      - post:
          url: "/authorizations"
          json:
            accountId: "{{ createdAccountId }}"
          headers:
            Content-Type: "application/json"
            Authorization: "Bearer {{ $processEnvironment.AUTH_TOKEN }}"
          log: "Granting access to another account."
          think: 1
          expect:
            - statusCode: 200
            - hasProperty: "authorizationId"

      # List accounts who have access to my account
      - get:
          url: "/authorizations"
          headers:
            Authorization: "Bearer {{ $processEnvironment.AUTH_TOKEN }}"
          log: "Confirming access via GET request to /authorizations."
          think: 1
          expect:
            - statusCode: 200
            - hasProperty: "authorizations"
            - hasProperty: "authorizations[0].accountId"
            - hasProperty: "authorizations[0].authorizationId"

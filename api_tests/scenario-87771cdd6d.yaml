# ********RoostGPT********
# Test generated by RoostGPT for test credential-integration-artillery using AI Type Azure Open AI and AI Model roost-gpt4-32k



# ********RoostGPT********
config:
    target: "{{ $processEnvironment.API_HOST }}"
    phases: 
      - duration: 60
        arrivalRate: 20
    plugins:
        expect: {}
    environments:
        stage:
            target: "{{ $processEnvironment.API_HOST }}"
    payload:
        path: "scenario-87771cdd6d.csv"
        fields:
          - authorization_id
        skipHeader: true
    headers:
        Token: "{{ $processEnvironment.AUTH_TOKEN }}"

scenarios: 
  - name: "Delete authorization"
    flow: 
      - log: "Sending DELETE request to /authorizations/ID"
      - delete:
          url: "/authorizations/{{ authorization_id }}"
          headers:
            Token: "{{ $processEnvironment.AUTH_TOKEN }}"
          expect: 
            - statusCode: 200
            - hasHeader: 'api-version'
            - headerEquals: {"api-version": "1.0.0"}
          # Make sure the response does not contain the authorization ID given as it was deleted
          - !assert "response.body.findIndex(item => item.id === `${{ authorization_id }}`) === -1"
      - think: 5

      - log: "Sending GET request to /authorizations to verify the delete operation"
      - get:
          url: "/authorizations"
          headers:
            Token: "{{ $processEnvironment.AUTH_TOKEN }}"
          expect: 
            - statusCode: 200
            - hasProperty: "data"
            - hasHeader: 'api-version'
            - headerEquals: {"api-version": "1.0.0"}

          #Check response body
          - equals: {"total": "integer(min: 0)"}
          - hasProperty: "authorizations.0.id"
          - hasProperty: "authorizations.0.name"
          - hasProperty: "authorizations.0.email"
          - hasProperty: "authorizations.0.createdAt"
          - hasProperty: "authorizations.0.updatedAt"
          # Verify that the authorization ID does not exist in the list after deletion
          - !assert "response.body.findIndex(item => item.id === `${{ authorization_id }}`) === -1"
